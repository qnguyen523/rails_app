%thead
  %tr
    %th Completed
    %th ID
    %th Title (Sub Title)
    %th Priority
    %th Due Date
    %th Actions
%tbody
  - disable_checkbox = local_assigns[:disable_checkbox]
  - list_all = local_assigns[:list_all]
  - @tasks.each do |task|
    %tr
      %td=check_box_tag("task_#{task.id}", true, task.completed, disabled: disable_checkbox)
      %td= task.id
      %td
        %strong= task.title
        .text-secondary= task.sub_title
      - priority = task&.priority
      - if priority == 'low_priority'
        - priority_class = 'bg-success'
      - elsif priority == 'medium_priority'
        - priority_class = 'bg-warning'
      - elsif priority == 'high_priority'
        - priority_class = 'bg-danger'
      - else
        - priority_class = 'bg-light text-dark'
      %td
        .badge{class: priority_class, style: "font-size: 1.0rem;"}
          = priority&.titleize&.upcase || 'NO PRIORITY SET'
      %td
        .badge.bg-light.text-dark{style: "font-size: 1.0rem;"}
          .bi.bi-clock &nbsp &nbsp #{task.due_date&.localtime&.strftime('%a, %d %b %Y,%l:%M:%p')}
      %td
        = link_to 'Show', task_path(id: task.id), class: 'btn btn-primary btn-sm'
        = link_to 'Delete', task_path(id: task.id), method: :delete, class: 'btn btn-danger btn-sm', id: 'delete_link', :confirm => 'Are you sure?' if list_all

:javascript
  $(document).ready(() => {
    $('#js-list-table input[type=checkbox]').on('change', function(e) {
      e.preventDefault();
      let id = $(this).attr('id').split('_')[1];
      let completed = $(this).is(':checked');
      list_all = #{list_all};
      if (completed || list_all) {
        url = list_all ? '/tasks/' + id + '?list_all=true' : '/tasks/' + id;
        $.ajax({
          url: url,
          type: 'PATCH',
          headers: {
            'X-CSRF-Token': "#{form_authenticity_token.to_s}"
          },
          data: { completed: completed },
          success: function(data) {
            // console.log(data);
          }
        });
      }
    });
    $('#js-list-table #delete_link').off('click').on('click', function(e) {
      e.preventDefault();
      let url = $(this).attr('href');
      $.ajax({
        url: url,
        type: 'DELETE',
        headers: {
          'X-CSRF-Token': "#{form_authenticity_token.to_s}"
        },
        success: function(data) {
          // console.log(data);
        }
      });
    });
  });